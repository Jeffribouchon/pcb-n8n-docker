{
  "nodes": [
    {
      "id": "Start",
      "parameters": {},
      "name": "Start",
      "type": "n8n-nodes-base.start",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "id": "HTTP_LaCentrale_ScraperAPI",
      "parameters": {
        "url": "https://api.scraperapi.com/?api_key=0a4066abcf8f76b4fc60653d7531bcc5&url=http://www.autoccasion29.com/recherche?form%5BmakerSlug%5D=peugeot&form%5BmodelSlug%5D=2008&form%5BenergySlug%5D=essence&form%5Bsave%5D=",
        "responseFormat": "string",
        "options": {
          "followRedirect": true,
          "timeout": 30000,
          "headers": {
            "User-Agent": "Mozilla/5.0"
          }
        }
      },
      "name": "HTTP - La Centrale via ScraperAPI",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "id": "Parse_HTML",
      "parameters": {
        "functionCode": "const cheerio = require('cheerio');\nconst $ = cheerio.load(items[0].json.body);\nconst results = [];\n\n$('.SearchCard').each((index, element) => {\n  const title = $(element).find('.SearchCard__title').text().trim();\n  const price = $(element).find('.SearchCard__price').text().trim();\n  const year = $(element).find('.SearchCard__year').text().trim();\n  const km = $(element).find('.SearchCard__mileage').text().trim();\n  const link = 'https://www.lacentrale.fr' + $(element).find('a').attr('href');\n\n  results.push({\n    json: {\n      title,\n      price,\n      year,\n      km,\n      link\n    }\n  });\n});\n\nreturn results;"
      },
      "name": "Parse HTML",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [700, 300]
    },
    {
      "id": "Send_Email",
      "parameters": {
        "fromEmail": "ton_email@exemple.com",
        "toEmail": "destinataire@exemple.com",
        "subject": "Résultats La Centrale via ScraperAPI",
        "text": "Voici les résultats de ta recherche :\n\n{{$json[\"title\"]}} - {{$json[\"price\"]}} - {{$json[\"year\"]}} - {{$json[\"km\"]}}\n{{$json[\"link\"]}}"
      },
      "name": "Envoyer Résultats",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 1,
      "position": [950, 300]
    }
  ],
  "connections": {
    "Start": {
      "main": [
        [
          {
            "node": "HTTP - La Centrale via ScraperAPI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP - La Centrale via ScraperAPI": {
      "main": [
        [
          {
            "node": "Parse HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse HTML": {
      "main": [
        [
          {
            "node": "Envoyer Résultats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}
